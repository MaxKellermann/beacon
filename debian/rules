#!/usr/bin/make -f
# -*- mode: makefile; coding: utf-8 -*-

MESON_OPTIONS = \
	-Djavaclient=enabled \
	-Dsystemd=enabled

# Extract version from changelog
DEB_VERSION := $(shell dpkg-parsechangelog -S Version | cut -d- -f1)

%:
	dh $@

.PHONY: override_dh_auto_configure
override_dh_auto_configure:
	dh_auto_configure -- $(MESON_OPTIONS)

.PHONY: override_dh_auto_install
override_dh_auto_install:
	dh_auto_install
	mkdir -p debian/libbeacon-client-java/usr/share/java
	mv debian/tmp/usr/share/java/BeaconClient.jar debian/libbeacon-client-java/usr/share/java/BeaconClient-$(DEB_VERSION).jar

.PHONY: override_dh_install
override_dh_install:
	dh_install
	ln -sf BeaconClient-$(DEB_VERSION).jar debian/libbeacon-client-java/usr/share/java/BeaconClient.jar

.PHONY: override_dh_installsystemd
override_dh_installsystemd:
	if test -f debian/beacon-receiver/usr/lib/systemd/system/beacon-receiver.service; then mkdir -p debian/beacon-receiver/lib/systemd/system; mv debian/beacon-receiver/usr/lib/systemd/system/beacon-receiver.service debian/beacon-receiver/lib/systemd/system/; fi
	dh_installsystemd
